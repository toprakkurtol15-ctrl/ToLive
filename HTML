<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Giriş Yap ve Video Yükle</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Basit bir form tasarımı */
        body { display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column; gap: 20px;}
        .auth-box, .upload-box { background: #1e1e1e; padding: 20px; border-radius: 10px; width: 300px; text-align: center; }
        input { width: 100%; padding: 10px; margin: 5px 0; background: #121212; border: 1px solid #333; color: white; }
        button { width: 100%; padding: 10px; background: #cc0000; color: white; border: none; cursor: pointer; margin-top: 10px; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="auth-container" class="auth-box">
        <h2>Giriş Yap / Kayıt Ol</h2>
        <input type="email" id="email" placeholder="E-posta">
        <input type="password" id="password" placeholder="Şifre">
        <button onclick="register()">Kayıt Ol</button>
        <button onclick="login()" style="background: #333;">Giriş Yap</button>
    </div>

    <div id="upload-container" class="upload-box hidden">
        <h2>Video Yükle</h2>
        <p id="user-display"></p>
        <input type="text" id="video-title" placeholder="Video Başlığı">
        <input type="file" id="video-file" accept="video/*">
        <button onclick="uploadVideo()">Yükle</button>
        <p id="status"></p> </div>

    <script type="module">
        // Firebase kütüphanelerini içe aktarıyoruz
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- BURAYA KENDİ FIREBASE CONFIG KODLARINI YAPIŞTIR ---
        const firebaseConfig = {
            apiKey: "SENIN_API_KEYIN",
            authDomain: "SENIN_PROJEN.firebaseapp.com",
            projectId: "SENIN_PROJE_ID",
            storageBucket: "SENIN_PROJEN.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };
        // -------------------------------------------------------

        // Firebase'i başlat
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const storage = getStorage(app);
        const db = getFirestore(app);

        // Kullanıcı Kayıt Fonksiyonu
        window.register = async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                await createUserWithEmailAndPassword(auth, email, pass);
                alert("Kayıt başarılı! Şimdi giriş yapabilirsiniz.");
            } catch (error) {
                alert("Hata: " + error.message);
            }
        }

        // Kullanıcı Giriş Fonksiyonu
        window.login = async () => {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            try {
                await signInWithEmailAndPassword(auth, email, pass);
                // Giriş başarılıysa authStateChanged tetiklenecek
            } catch (error) {
                alert("Giriş hatası: " + error.message);
            }
        }

        // Oturum Kontrolü (Giriş yapıldı mı?)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('upload-container').classList.remove('hidden');
                document.getElementById('user-display').innerText = "Hoşgeldin: " + user.email;
            }
        });

        // Video Yükleme Fonksiyonu
        window.uploadVideo = async () => {
            const file = document.getElementById('video-file').files[0];
            const title = document.getElementById('video-title').value;
            const status = document.getElementById('status');

            if (!file || !title) return alert("Lütfen dosya ve başlık girin.");

            status.innerText = "Yükleniyor... Lütfen bekleyin.";

            try {
                // 1. Videoyu Storage'a yükle
                const storageRef = ref(storage, 'videos/' + Date.now() + '-' + file.name);
                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);

                // 2. Video bilgisini Database'e kaydet
                await addDoc(collection(db, "videos"), {
                    title: title,
                    url: downloadURL,
                    uploader: auth.currentUser.email,
                    date: new Date()
                });

                status.innerText = "Yükleme Başarılı!";
                alert("Video yüklendi ve veritabanına kaydedildi.");
                
            } catch (error) {
                console.error(error);
                status.innerText = "Hata oluştu.";
            }
        }
    </script>
</body>
</html>
